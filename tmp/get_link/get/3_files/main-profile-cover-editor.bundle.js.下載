!function(){return function e(t,i,n){function o(r,s){if(!i[r]){if(!t[r]){var d="function"==typeof require&&require;if(!s&&d)return d(r,!0);if(a)return a(r,!0);var h=new Error("Cannot find module '"+r+"'");throw h.code="MODULE_NOT_FOUND",h}var c=i[r]={exports:{}};t[r][0].call(c.exports,function(e){return o(t[r][1][e]||e)},c,c.exports,e,t,i,n)}return i[r].exports}for(var a="function"==typeof require&&require,r=0;r<n.length;r++)o(n[r]);return o}}()({1:[function(e,t,i){(function(e){var t=("undefined"!=typeof window?window.Backbone:void 0!==e?e.Backbone:null).View.extend({initialize:function(){var e=this.$el.find(".coverImage"),t=this.$el.find("#social_banner"),i=t.width()/t.height(),n=e.width()/e.height();this.direSwitch=i>=n?2:1;var o=this.$el.attr("data-type");this.containerRatio=n,this.containerWidth=e.width(),this.containerHeight=e.height(),this.$container=e,this.$img=t,this.top=this.$img.css("top"),this.left=this.$img.css("left"),this.$upload_type=o,"group"===o&&(this.$group_id=this.$el.attr("data-group_id"))},movable:!1,editMode:!1,events:{"change .uploadimage":"fileUpload",editmode:"editModeOn","touchstart .covermask":"moveImg","mousedown .covermask":"moveImg","mousemove .covermask":"movingImg","touchmove .covermask":"movingImg","touchend .covermask":"imgMoveEnd","mouseup .covermask":"imgMoveEnd","mouseout .covermask":"imgMoveEnd","click .editmode-off":"editModeOff","click .editmode-on":"editModeOn",imgLoaded:"imgLoaded",fileRead:"fileRead"},imgLoaded:function(){this.$el.trigger("editmode"),pageSpinner.done()},editModeOff:function(){this.top=parseInt(this.$img.css("top"),10),this.left=parseInt(this.$img.css("left"),10),this.editMode=!1,this.$el.removeClass("editing"),this.postPosition()},editModeOn:function(){this.$el.addClass("editing"),this.$el.find(".edit-message").fadeIn(400,function(){$(this).delay(3e3).fadeOut(400)}),this.editMode=!0},imgMoveEnd:function(){this.movable=!1,this.top=this.$img.css("top"),this.left=this.$img.css("left")},movingImg:function(e){if(!this.movable)return!1;e.stopPropagation(),e.preventDefault();var t=null,i=null;"mousemove"===e.type?(t=e.pageY-this.anchorY,i=e.pageX-this.anchorX):(t=e.originalEvent.touches[0].pageY-this.anchorY,i=e.originalEvent.touches[0].pageX-this.anchorX),1===this.direSwitch&&this.setImg(parseInt(this.top,0,10)+t,0,"social_banner"),2===this.direSwitch&&this.setImg(0,parseInt(this.left,0,10)+i,"social_banner")},moveImg:function(e){if(!this.editMode)return!1;this.movable=!0,"mousedown"===e.type?(this.anchorY=e.pageY,this.anchorX=e.pageX):(this.anchorY=e.originalEvent.touches[0].pageY,this.anchorX=e.originalEvent.touches[0].pageX),top=this.$img.offset().top},postPosition:function(){var e=this,t=this.top,i=this.left;pageSpinner.show(),$.ajax({url:SOCIAL_URL+"api/profile/update_profile_setting",type:"POST",data:{top:t,left:i,type:this.$upload_type,group_id:this.$group_id}}).done(function(t){"ok"===t.status&&(pageSpinner.done(),e.endEditing())})},setImg:function(e,t,i,n){var o=this;switch(i){case"social_banner":var a=o.$container.height(),r=o.$container.width();break;case"social_avatar":var s;"object"==typeof n?($(".my-avatar").attr("src",n.small),s=n.medium):s=n,o.$el.find("#social_avatar").attr("src",s),pageSpinner.done();break;default:return}var d=function(e,t){var i=o.$img,n=i.height(),s=i.width(),d=a-n,h=r-s;e>0?i.css({top:"0px"}):e<=d?i.css({top:d+"px"}):i.css({top:e+"px"}),t>0?i.css({left:"0px"}):t<=h?i.css({left:h+"px"}):i.css({left:t+"px"})};if(n){var h=new Image;h.src=n,h.onload=function(){o.$img.attr("src",n),o.$img=o.$el.find("#social_banner"),o.$el.trigger("imgLoaded"),d(e,t),o.$img.show()}}else d(e,t)},endEditing:function(){},fileUpload:function(e){var t=this;e.preventDefault();var i=function(i,n){var o=new FormData(e.currentTarget);o.append("type",t.$upload_type),o.append("group_id",t.$group_id),i&&(o.append("top",i),o.append("mode",1)),n&&(o.append("left",n),o.append("mode",2)),pageSpinner.show(),$.ajax({url:SOCIAL_URL+"api/profile/update_profile_setting",type:"POST",data:o,contentType:!1,cache:!1,processData:!1,xhrFields:{withCredentials:!0}}).done(function(i){var n,o=i.type,a=0,r=0;switch(o){case"social_banner":t.$img.hide();var s=i.banner_setting.mode;a=i.banner_setting.top,r=i.banner_setting.left,n=i.banner_setting.path,2===s?(t.$img.css({width:"auto",height:"100%"}),t.direSwitch=2):(t.$img.css({width:"100%",height:"auto"}),t.direSwitch=1);break;case"social_avatar":n=i.avatar_path;break;default:return}t.setImg(a,r,o,n),e.currentTarget.reset()})};if(window.FileReader){var n=new FileReader;n.onload=function(){var e=new Image;e.onload=function(){var n,o,a=e.width,r=e.height;a/r<=3?(n=-parseInt(1140*r/a/2,10)+t.$container.height()/2,o=0):(n=0,o=-parseInt(350*a/r/2,10)+t.$container.width()/2),t.top=n,t.left=o,i(n,o)},e.src=n.result},n.readAsDataURL(e.target.files[0])}else i()},el:".profile-operator",render:function(){return this}});$(window).on("load",function(){new t})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1]);